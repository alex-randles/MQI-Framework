<!DOCTYPE html>
{% extends "change_detection/base_home.html" %}
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>{% block title %}SHACL Shapes{% endblock %}</title>
    <script type="text/javascript"  src="{{ url_for('static', filename='js_scripts.js') }}"> </script>
</head>
<body>

{% block content %}
<h3 class="h2 text-center mt-2">SHACL Shape Generation</h3>
<form method="POST" action="{{ url_for('generate_shacl_shapes') }}" onSubmit="move();" enctype="multipart/form-data" id="shape-generation-form" >
    <div class="container-fluid">
        <div class="row d-flex justify-content-center py-1 text-center">
            <div class="col-sm-6 bg-light py-2 justify-content-center">
                <h4 class="h4">Source Data Details</h4>
                <label class="form-label" >
                    Connect to a CSV file to generate a SHACL shape.
                </label>
                <div class="form-group">
                    <label for="source-data-url"><span class="fw-bold">Original: </span>Version 1 CSV URL</label>
                    <input type="url" class="form-control"
                           id="source-data-url" name="source-data-url" placeholder="Source Data URL" required>
                </div>
            </div>
            <div class="row d-flex justify-content-center py-1">
                <div class="col-sm-6 text-center">
                    {% with messages = get_flashed_messages() %}
                    {% if messages %}
                    {% for msg in messages %}
                    <div class="alert alert-danger" role="alert">
                        <h4 class="alert-heading">Error</h4>
                        {{msg}}
                    </div>
                    {% endfor %}
                    {% endif %}
                    {% endwith %}
                </div>
            </div>
        </div>
    </div>
    <div class="container-fluid">
        <div class="row d-flex justify-content-center">
            <div class="col-sm-12 text-center">
                <input class="my-2 btn btn-primary" id="button-style" type= "submit" value="Generate Shape" />
            </div>
        </div>
        <div class="row d-flex justify-content-center my-1">
            <div class="col-6">
                <div class="progress" id="myProgress" >
                    <div class="progress-bar progress-bar-striped" id="myBar" role="progressbar"  aria-valuenow="0" aria-valuemin="0" aria-valuemax="100"></div>
                </div>
            </div>
        </div>
        <div class="row d-flex justify-content-center">
            <div class="col-sm-12 text-center"  id="download-div" style="display:none">
                <a href="{{ url_for('static', filename='shacl_shape.ttl')}}" class="my-2 btn btn-secondary" id="download-button">Download Shape</a>
            </div>
        </div>
    </div>
</form>

<script src="https://code.jquery.com/jquery-3.5.1.js" integrity="sha256-QWo7LDvxbWT2tbbQ97B53yJnYU3WhH/C8ycbRAkjPDc=" crossorigin="anonymous"></script>

<script type="text/javascript">
    $(document).on('submit','#shape-generation-form',function(e) {
      e.preventDefault();
      $.ajax({
        type:'POST',
        url:'/shacl-shapes',
        data:{
          source_data_url:$("#source-data-url").val(),
        },
        success:function()
        {
          $("#download-div").css("display", "block");
          $("#myBar").css("display", "none");
        }
      })
    });
</script>


{% endblock %}

</body>
</html>

