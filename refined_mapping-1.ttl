@prefix xml: <http://www.w3.org/XML/1998/namespace> . 
@prefix rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> . 
@prefix rdfs: <http://www.w3.org/2000/01/rdf-schema#> . 
@prefix xsd: <http://www.w3.org/2001/XMLSchema#> . 
@prefix rr: <http://www.w3.org/ns/r2rml#> . 
@prefix cidoc: <http://erlangen-crm.org/current/> . 
@prefix b2022: <https://ont.beyond2022.ie/ontology#> . 

	
<#Organisation>	
 rdf:type rr:TriplesMap;	
	
 rr:logicalTable[ 	
 	 rr:sqlQuery""" 	
	SELECT 	
		D.ID,	
		D.NAME,	
		D.COUNTRY,	
		D.COMMENT,	
		X.ORGANISATIONTYPE	
	FROM	
		DATA D	
		LEFT OUTER JOIN (	
			WITH RECURSIVE ORGANISATIONTYPESPLITTED(ID, ORGANISATIONTYPE, REST) AS (	
				SELECT ID, NULL, ORGANISATIONTYPE || ';'	
				FROM (SELECT ID, ORGANISATIONTYPE FROM DATA) WHERE ORGANISATIONTYPE IS NOT NULL	
				UNION ALL	
				SELECT ID, TRIM(SUBSTR(REST, 0, INSTR(REST, ';') - 1)), SUBSTR(REST, INSTR(REST, ';') + 1) FROM ORGANISATIONTYPESPLITTED WHERE REST <> ''	
			) SELECT ID, ORGANISATIONTYPE FROM ORGANISATIONTYPESPLITTED WHERE ORGANISATIONTYPE IS NOT NULL	
		) X ON D.ID = X.ID	
	
	 """;	
 ];	
	
 rr:subjectMap[ 	
 	 rr:template "https://kb.beyond2022.ie/organisation/{COUNTRY}/{NAME}" ;	
	 rr:class cidoc:E74_Group;	
 ];	
	
 rr:predicateObjectMap[ 	
 	 rr:predicate cidoc:P2_has_type;	
	 rr:object b2022:Organisation;	
 ];	
	
 rr:predicateObjectMap[ 	
 	 rr:predicate cidoc:P1_is_identified_by;	
	 rr:objectMap [	
		 rr:parentTriplesMap <#Appellation> ;	
		 rr:joinCondition [	
			 rr:parent "ID" ;	
			 rr:child "ID" ;	
			 ];	
 		]; 	
 ];	
	
 rr:predicateObjectMap[ 	
 	 rr:predicate cidoc:P3_has_note;	
	 rr:objectMap [	
		 rr:datatype xsd:string;	
		 rr:column "COMMENT" ;	
		]; 	
 ];	
	
 rr:predicateObjectMap[ 	
 	 rr:predicate cidoc:P111_added;	
	 rr:objectMap [	
		 rr:template "https://ont.beyond2022.ie/ontology#{ORGANISATIONTYPE}" ;	
		]; 	
 ];	
.	
